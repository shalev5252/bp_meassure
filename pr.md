# Blood Pressure Monitoring Application  
## Full Product & Technical Specification (v2.0)

---

# 1. Executive Summary

The Blood Pressure Monitoring Application is a privacy-first, local-first mobile application designed to:

- Track and classify blood pressure readings.
- Maintain structured patient profiles.
- Store permanent medical and lifestyle risk factors.
- Provide analytics and trend detection.
- Deliver AI-assisted contextual insights (non-diagnostic).
- Support both English (LTR) and Hebrew (RTL).
- Follow the blood pressure classification standard commonly accepted in Israel (≥140/90 mmHg threshold).

This application is **not a medical device**, does not diagnose conditions, and does not provide treatment or emergency instructions.

---

# 2. Clinical Standard (Israel-Aligned)

Hypertension is defined as:

**≥140/90 mmHg**

## Blood Pressure Classification

| Category | Systolic (SYS) | Diastolic (DIA) |
|-----------|---------------|----------------|
| Normal | ≤130 | ≤85 |
| High-Normal / Borderline | 130–139 | 85–89 |
| Hypertension Grade 1 | 140–159 | 90–99 |
| Hypertension Grade 2 | 160–179 | 100–109 |
| Hypertension Grade 3 | ≥180 | ≥110 |
| Severe / Crisis | ≥180 and/or ≥120 |

---

# 3. Internationalization (i18n)

## Supported Languages
- English (`en`)
- Hebrew (`he`)

## Requirements
- Runtime language switching.
- Preference persisted locally.
- Hebrew layout must be RTL.
- English layout must be LTR.
- AI responses must match selected language.
- Dates and numbers localized.
- All UI strings must be localized (no hardcoded text).

---

# 4. System Architecture Overview

## Architecture Model
- Local-first mobile application.
- Stateless AI backend gateway.
- No server-side persistence of patient data (MVP).

## Components
- Flutter mobile application.
- FastAPI backend for AI processing.
- OpenAI (or equivalent) as AI provider.

---

# 5. Data Model

## 5.1 Patients

```

patients

* patient_id (UUID, PK)
* display_name (string)
* date_of_birth (optional)
* sex (enum)
* height_cm (optional)
* weight_kg (optional)
* created_at
* updated_at

```

---

## 5.2 Risk Factors

```

patient_risk_factors

* patient_id (FK)
* risk_code (enum)
* is_present (bool)
* notes (optional)
* updated_at

```

### Risk Codes

Chronic:
- diabetes_type2
- chronic_kidney_disease
- coronary_artery_disease
- heart_failure
- stroke_tia_history
- sleep_apnea
- thyroid_disorder
- hyperlipidemia

Lifestyle:
- smoker_current
- alcohol_high_intake
- high_salt_diet
- sedentary_lifestyle
- obesity
- chronic_stress

Family:
- family_history_hypertension

---

## 5.3 Medications

```

patient_medications

* medication_id (UUID)
* patient_id (FK)
* name
* dose_text
* frequency_text
* is_active
* started_on (optional)
* updated_at

```

No medication dosage advice may be generated by AI.

---

## 5.4 Readings

```

readings

* reading_id (UUID)
* patient_id (FK)
* systolic (int)
* diastolic (int)
* pulse (optional)
* taken_at (datetime)
* context_tags (JSON array)
* measurement_quality (valid | invalid | unsure)
* notes
* created_at
* updated_at

```

Invalid readings are excluded from analytics and AI processing.

---

# 6. Analytics Engine

Local deterministic calculations:

- 7-day average
- 30-day average
- Standard deviation
- Morning vs evening averages
- Linear trend slope
- Percentage above 140/90
- Percentage above 160/100

Invalid readings excluded.

---

# 7. Safety Engine

Red Flag triggers:

- SYS ≥ 180
- DIA ≥ 120

If triggered:
- Show safety warning screen.
- Disable AI response for that session.
- Advise medical consultation.
- No emergency treatment instructions provided.

---

# 8. AI Insight Module

## Purpose
- Explain trends.
- Contextualize with risk factors.
- Provide lifestyle guidance.
- Suggest discussion points for physician.

## Strict Prohibitions
- No diagnosis.
- No medication adjustments.
- No dosage recommendations.
- No emergency protocols.
- No definitive clinical statements.

---

## AI Request Payload

```

POST /v1/ai/analyze
Authorization: Bearer <token>

````

```json
{
  "patient": {...},
  "risk_factors": {...},
  "medications": [...],
  "readings": [...],
  "computed_metrics": {...},
  "safety_flags": {...},
  "ui_locale": "en",
  "user_question": "..."
}
````

---

## AI Response Format

```json
{
  "summary": "...",
  "pattern_analysis": "...",
  "contributing_factors": "...",
  "lifestyle_guidance": "...",
  "consult_recommendation": "...",
  "doctor_questions": ["..."],
  "disclaimer": "...",
  "safety_override_applied": false,
  "request_id": "uuid"
}
```

---

# 9. Flutter Project Architecture

```
lib/
  main.dart
  app.dart

  bootstrap/
  l10n/
  localization/

  core/
    constants/
    errors/
    logging/
    utils/
    widgets/

  data/
    db/
      tables/
      daos/
      migrations/
    repositories/
    sources/
      local/
      remote/
    mappers/

  domain/
    entities/
    enums/
    repositories/
    services/
      analytics/
      safety/
      export/
    usecases/

  presentation/
    routing/
    theme/
    state/
    screens/
      onboarding/
      home/
      readings/
      analytics/
      profile/
      ai/
      education/
      settings/
      export/

  infra/
    http/
    secure_storage/
    preferences/
```

---

# 10. FastAPI Backend Architecture

```
backend/
  app/
    main.py
    settings.py
    logging_config.py
    dependencies.py

    api/
      v1/
        router.py
        endpoints/
          health.py
          ai.py
          meta.py

    models/
      requests/
      responses/

    services/
      ai/
        ai_service.py
        prompt_builder.py
        response_parser.py
      safety/
        safety_rules.py
        safety_override.py
      localization/
        locale_policy.py
        disclaimers.py

    security/
      auth.py
      rate_limit.py
      cors.py
      redaction.py

    middlewares/
      request_id.py
      exception_handler.py
      timing.py

    clients/
      llm/
        openai_client.py
```

---

# 11. Backend Endpoints

## GET /health

```json
{ "status": "ok", "version": "2.0.0" }
```

## GET /meta/supported-locales

```json
{ "supported_locales": ["en", "he"] }
```

## POST /v1/ai/analyze

Authenticated. Rate limited.

Returns structured AI response.

---

# 12. Security & Privacy

* Local encrypted database.
* No persistent backend storage (MVP).
* No raw PII logging.
* HTTPS enforced.
* Rate limiting enabled.
* AI consent required.

---

# 13. Export

Users may export:

* PDF report (localized).
* CSV file.

Includes:

* Patient name
* Date range
* Averages
* Graph
* Reading table

---

# 14. Performance Targets

* Reading entry <100ms
* Graph render <300ms
* AI response <6s
* App cold start <2s

---

# 15. Non-Goals

* Medical diagnosis.
* Drug titration.
* Emergency triage system.
* Bluetooth integration (Phase 2).
* Physician direct messaging (Phase 2).

---

# 16. Phase Roadmap

## Phase 1

* Patient profiles
* Risk factors
* Manual readings
* Analytics
* Safety engine
* i18n
* AI insights
* Export

## Phase 2

* Cloud sync
* Caregiver accounts
* Bluetooth integration
* Physician report (FHIR format)
* AI citation references

---

# End of Specification

